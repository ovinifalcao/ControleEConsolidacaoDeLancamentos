
# ADR: 009 - Utilização de um cache para o relatório e sua tecnologia

Data: 2025-10-30

Responsável: André Vinícius Falcão

## :open_book: Contexto
Existe para a aplicação `Consolidação Financeira API` um requisito de performance que exige algumas considerações para que possa escalar bem, trata-se do `RNF01`, onde está descrito uma falha máxima de 5%, com 50 operações por segundo. Para atingir essa velocidade sem prejudicar o banco e também tentando mitigar eventos de concorrência que possam atrapalhar a gravação dos registros na base através do `Consolidação Financeira Worker`.
  

## :bulb: Decisão
A estratégia escolhida é utilizar um Cache Redis para que seja possível manter os valores do relatório por um curto período de tempo, evitando assim chamadas recorrentes na base de dados. Isso garante que o requisito `RNF01` seja atendido sem prejudicar as operações dos demais componentes do sistema. Considere o exemplo: A cada três minutos o cache é invalidado e faz uma única consulta a base de dados para ser capaz de responder todos os consumidores. Esse tempo de atualização menos constante pode evitar chamadas constantes de agentes que estejam tentando verificar o valor a todo momento, podendo ter seus endereços temporariamente bloqueados ou fazendo a aplicação responder com `429 - Too many requests`.

## :balance_scale: Justificativa
A utilização do Cache Redis, permite que a aplicação possa escalar em réplicas tendo sempre a mesma fonte de valor para qualquer uma delas.  Além de ser de fácil implementação nos provedores de nuvem considerados.

Consideração para o uso Inicial em nuvem:

| Provedor de Nuvem | Nome do Serviço | Custo Mínimo Mensal |
|--|--|--|
| Azure | Az Cache | $15 / mês  |
| AWS | ElastiCache  | $13 / mês  |
| GCP | Memorystore  | $35 / mês  |

## :bulb: Alternativas Consideradas

Existem outras opções de Cache que poderiam ser consideradas, como o Cache em memória da própria aplicação, essa estratégia tem um grau maior para escalar, uma vez que utiliza os recursos locais da própria aplicação está restrita àquela instancia. Suponha uma futura escala para o ambiente Kubernetes, cada replica teria seu próprio valor, esse descasamento de valores poderia gerar problemas aos agentes consumidores do relatório.

Outra opção considerada era a de não utilizar o Cache  e ir diretamente buscar as informações no banco de dados. Para não correr o risco de que os serviços envolta fossem afetados, este serviços teriam de escalar suas capacidades computacionais, gerando mais custo o que não é desejável.


## :hourglass_flowing_sand: **Consequências**
:white_check_mark: **Positivas**
- Eficácia na distribuição da aplicação para outros serviços.
- Estratégia resiliente para atender os requisitos.

:no_entry: **Negativas**
- Maior custo de operação direta. (Considere a sessão Alternativas consideradas)
- Maior número de componentes para gerenciar.
