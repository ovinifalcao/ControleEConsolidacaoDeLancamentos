
# ADR: 006 - Utilização do Worker para processamento de mensagens e sua tecnologia.

Data: 2025-10-29

Responsável: André Vinícius Falcão

## :open_book: Contexto
Os contextos`Controle de Lançamentos`, `Consolidação Financeira` se comunicam através de uma mensagens como descrito na `ADR 005`, as mensagens precisam ser consolidadas, ou seja, precisam ser processadas por um serviço capaz de entender a natureza das mensagens e sua devida influencia sobre o relatório consolidado.
  

## :bulb: Decisão
Será utilizado uma aplicação Worker, capaz de inscrever-se no tópico do Kafka para receber as mensagens publicadas pela aplicação `Controle de Lançamentos API`. Essa aplicação deverá ser a única responsável por saber como tratar e consolidar os diversos tipos de lançamentos, interpretar e efetivar em base os detalhes de cada mensagem efetua no relatório.

Consideração para o uso Inicial em nuvem:

| Provedor de Nuvem | Nome do Serviço | Custo Mínimo Mensal |
|--|--|--|
| Azure | Azure Functions | $0.20 / 1 milhão de operações |
| AWS | AWS Lambda | $0.20 / 1 milhão de operações |
| GCP | Google Cloud Run | $0.40 / 1 milhão de operações  |

## :balance_scale: Justificativa
A tecnologia escolhia .Net Core, possibilita que a aplicação seja criada como um aplicativo console, aonde apenas as necessidades específicas (bibliotecas) sejam adicionadas ao serviço, possibilitando nos provedores de Cloud considerados a utilização de funções hospedadas em serviços. A escolha da tecnologia também está de acordo com a ADR 002 que defende a necessidade de um mesmo time poder atuar nas diversas aplicações do sistema.
  

## :bulb: Alternativas Consideradas
Na ADR 005 é considerada a comunicação direta entre os serviços.

É possível também considerar que a aplicação `Consolidação Financeira API` fosse responsável por receber as mensagens e garantir a consolidação do relatório, no entanto iria estar em desacordo com a ADR 002 onde está proposto a construção do contexto utilizando CQRS para segregar as operações entre serviços. Bem como estaríamos promovendo a interferência da carga da consulta ao relatório na consolidação do relatório o que poderia gerar atrasos na consulta aos valores.

## :hourglass_flowing_sand: **Consequências**
:white_check_mark: **Positivas**
- Melhor distribuição das capacidades das Aplicações
- Estratégia de CQRS segregando as capacidades das aplicações.

:no_entry: **Negativas**

- Aumento de custo para manter toda a infraestrutura.
- Maior necessidade de gerenciamento por adicionar mais um componente ao sistema.