
# ADR: 002 - Escolha da arquitetura das Operações Como Eventos Únicos

Data: 2025-10-28

Responsável: André Vinícius Falcão

## :open_book: Contexto
As aplicações que consomem o sistema tem de cumprir o RF03, possibilitando que as ações de lançamento financeiro sejam auditáveis, por tratar-se de um sistema de uso comercial essa rastreabilidade das operações é importante para garantir a conformidade com as Leis do país, garantindo que seja possível prestar contas.
  

## :bulb: Decisão
Como foi possível notar na sessão de `Modelagem dos Domínios` ao trabalhar com os Controle de lançamentos transacionais não será possível a edição ou deleção do registro, antes, será necessário um novo registro que sobrescreva as ações do lançamento anterior. Exemplo: Um débito não pode ter seu registro cancelado ou apagado, será necessário fazer um novo registro com natureza de `Cancelamento de Débito` para remover aquele débito. Isso garante: 
- Rastreamento completo do ciclo de vida de um Lançamento, recuperando todos os registros a ele associados. 
- Garante a consistência do relatório consolidado, mesmo que hajam interrupções ou que as mensagens sejam entregues de forma desordenada. 

Para completar implementação a mensageria é utilizada no modelo `Publisher-Subscriber`, garantindo consistência dos valores, sem alterar a performance das aplicações críticas da ponta.

  

## :balance_scale: Justificativa
- Garante a possibilidade de que as ações no sistema sejam auditadas.
- Garante a consistência de cada evento e a possível recuperação, em um cenário onde o `Worker` fique fora do ar por alguns instante ou mais tempo, seria possível continuar a consolidação sem prejuízo no calculo.
- Não depende de mensagens ordenadas.
  

## :bulb: Alternativas Consideradas
Foi considerado utilizar uma abordagem de Flags onde é possível marcar um registro de lançamento como cancelado. Essa abordagem apresenta os seguintes problemas:
- Exige mais de uma ação em banco. Seria necessário recuperar um registro completo marca-lo e salvar novamente. 
- No caso do concorrência pelo registro seria mais difícil de manter a consistência da sequencia das ações, o que exigiria um fluxo mais detalhado de tratamento.

Por causa desses motivos a abordagem foi desconsiderada.
  

## :hourglass_flowing_sand: **Consequências**
:white_check_mark: **Positivas**

Os eventos podem ser repetidos para verificações, auditorias e recuperação das bases.

  

:no_entry: **Negativas**

Haverá um maior numero de registro nos bancos de dados.